> 无论是服务端还是客户端，当我们读取或者发送消息的时候，都需要考虑TCP底层的粘包/拆包机制。

## TCP传输









1. 



## TCP粘包/拆包

**TCP是个“流”协议**，所谓流，就是没有界限的一串数据。大家可以想想河里的流水，是连成一片的，其间并没有分界线。TCP底层并不了解上层业务数据的具体含义，它会根据TCP缓冲区的实际情况进行包的划分，所以在业务上认为，一个完整的包可能会被TCP拆分成多个包进行发送，也有可能把多个小的包封装成一个大的数据包发送，这就是所谓的TCP粘包和拆包问题。



#### **为什么会发生TCP粘包、拆包**

1. 应用程序写入的数据大于套接字缓冲区大小，这将会发生拆包。
2. 进行MSS（最大报文长度）大小的TCP分段，当TCP报文长度-TCP头部长度>MSS的时候将发生拆包。
3. 应用程序写入数据小于套接字缓冲区大小，网卡将应用多次写入的数据发送到网络上，这将会发生粘包。
4. 接收方法不及时读取套接字缓冲区数据，这将发生粘包。







## 补充思考

### 为什么UDP不会粘包

1.TCP协议是面向流的协议，UDP是面向消息的协议

UDP段都是一条消息，具有保护消息边界，在每个UDP包中就有了消息头（消息来源地址，端口等信息）,应用程序必须以消息为单位提取数据，不能一次提取任意字节的数据.

这样对于接收端来说就容易进行区分处理了。传输协议把数据当作一条独立的消息在网上传输，接收端只能接收独立的消息。接收端一次只能接收发送端发出的一个数据包,如果一次接受数据的大小小于发送端一次发送的数据大小，就会丢失一部分数据，即使丢失，接受端也不会分两次去接收.



## 参考

https://juejin.im/post/5b67902f6fb9a04fc67c1a24

http://www.hchstudio.cn/article/2018/d5b3/